<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wuweibi.bullet.mapper.DomainMapper">

	<!--	根据用户ID查询归属域名-->
	<select id="selectByUserId" resultType="com.wuweibi.bullet.domain.vo.DomainVO" parameterType="java.lang.Long">
		select id, domain, type, status, due_time as dueDateTime from t_domain where user_id = #{userId}
	</select>

<!--	获取可购买的域名列表-->
	<select id="selectBuyList" resultType="com.wuweibi.bullet.domain2.domain.DomainBuyListVO">
		select id, domain, type, status, original_price,sales_price  from t_domain
		<where>
		 	status = 0 and user_id is null
			<if test="params.type != null">
				and type = #{params.type}
			</if>
			<if test="params.keyword != null and params.keyword != ''">
				and domain like concat(#{params.keyword},'%')
			</if>
		</where>
	</select>

<!--	获取最大的端口号-->
    <select id="selectMaxPort" resultType="java.lang.Integer">
		select max(domain) from t_domain WHERE type = 1
	</select>

    <select id="selectListNotBindByUserId" resultType="com.alibaba.fastjson.JSONObject">
		select d.id,d.domain, d.type, st.server_addr serverAddr
		from t_domain d
		left join t_server_tunnel st on st.id = d.server_tunnel_id
		where d.user_id = #{userId} and d.type=#{type}
		 and d.id not in (select DISTINCT IFNULL(domain_id,0) from t_device_mapping where userId = #{userId})

	</select>
</mapper>
