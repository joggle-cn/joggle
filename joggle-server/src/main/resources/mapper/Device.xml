<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wuweibi.bullet.mapper.DeviceMapper">



	<update id="updateName" parameterType="map">
		update t_device set name =#{name} where id =#{id}
	</update>

	<select id="exists" resultType="boolean" parameterType="map">
		select count(1) from t_device where userId = #{userId} and id = #{id}
	</select>

	<select id="existsNoBindDevice" resultType="boolean" parameterType="map">
		select count(1) from t_device where deviceId = #{deviceId} and userId > 0
	</select>

<!--	获取设备详情-->
    <select id="selectDeviceInfoById" resultType="com.alibaba.fastjson.JSONObject">
		select
		   a.`id`, a.`name`, a.`deviceId` as deviceNo, a.`createTime`, a.userId as userId, a.`intranet_ip` as intranetIp,
		       a.`mac_addr` macAddr,
		       b.name as lineName,
		       b.broadband as broadband,
			   b.server_addr as serverAddr
		from t_device a
		left join t_server_tunnel b on a.server_tunnel_id = b.id
		where a.id = #{deviceId}
	</select>

<!--	获取设备下拉列表-->
    <select id="selectOptionListByUserId" resultType="com.wuweibi.bullet.device.domain.vo.DeviceOption">
	    select
			d.`id`, d.`name`, d.`deviceId` as deviceNo, do.`intranet_ip`, do.`status`, do.`public_ip`
		from t_device d
		left join t_device_online do on d.deviceId = do.deviceNo
		where d.userId = #{userId}
        order by do.status asc , do.`updateTime` desc
	</select>


    <select id="selectWebListByUserId" resultType="com.wuweibi.bullet.domain.dto.DeviceDto">
		select
			d.`id`, d.`name`, d.`deviceId` as deviceNo,
		   do.`status`, do.`public_ip`, do.`intranet_ip`,do.mac_addr,
		   do.updateTime onlineTime

		from t_device d
		 left join t_device_online do on d.deviceId = do.deviceNo
		where d.userId = #{userId}
		order by do.status desc , do.`updateTime` desc
	</select>
<!--	获取设备详情-->
    <select id="selectDetail" resultType="com.wuweibi.bullet.device.domain.DeviceDetail">
		select
			d.`id`, d.`name`, d.`deviceId` as deviceNo, d.userId,
			do.`status`, do.`public_ip`,
		       do.`intranet_ip`,do.mac_addr,
			do.updateTime onlineTime, do.arch, do.os, do.server_tunnel_id
		from t_device d
	    left join t_device_online do on d.deviceId = do.deviceNo
		where d.id = #{deviceId}
	</select>


</mapper>
